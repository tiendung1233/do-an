# ĐẶC TẢ USE CASE - HỆ THỐNG SmartCash SHOPPING

## 2.3. Đặc tả Use Case

### 2.3.1. Chức năng: Đăng nhập

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Đăng nhập                                                                                                                                                                                                                                                                                            |
| **Actor**              | Người dùng, Admin                                                                                                                                                                                                                                                                                    |
| **Điều kiện**          | - Người dùng đã truy cập trang web<br>- Người dùng đã có tài khoản                                                                                                                                                                                                                                   |
| **Kích hoạt**          | Người dùng nhập email và mật khẩu hoặc chọn đăng nhập bằng Google                                                                                                                                                                                                                                    |
| **Hành động tác nhân** | Nhập email và mật khẩu, hoặc chọn nút "Đăng nhập bằng Google"                                                                                                                                                                                                                                        |
| **Phản ứng hệ thống**  | - Kiểm tra thông tin đăng nhập (email/mật khẩu hoặc tài khoản Google)<br>- Nếu thông tin chính xác:<br> • Tạo phiên đăng nhập và trả về thông tin người dùng<br> • Chuyển người dùng đến trang chủ<br>- Nếu thông tin không chính xác:<br> • Hiển thị thông báo lỗi "Email hoặc mật khẩu không đúng" |

---

### 2.3.2. Chức năng: Thêm giỏ hàng

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                            |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **UseCase**            | Thêm sản phẩm vào giỏ hàng                                                                                                                                                                                                                                                                                                                       |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                       |
| **Điều kiện**          | - Người dùng đã đăng nhập<br>- Người dùng đang xem chi tiết sản phẩm                                                                                                                                                                                                                                                                             |
| **Kích hoạt**          | Người dùng chọn số lượng và click "Thêm vào giỏ hàng"                                                                                                                                                                                                                                                                                            |
| **Hành động tác nhân** | Chọn số lượng sản phẩm và click nút "Thêm vào giỏ hàng"                                                                                                                                                                                                                                                                                          |
| **Phản ứng hệ thống**  | - Kiểm tra đăng nhập<br>- Nếu chưa đăng nhập: Yêu cầu đăng nhập<br>- Nếu đã đăng nhập:<br> • Kiểm tra sản phẩm đã có trong giỏ chưa<br> • Nếu chưa có: Thêm sản phẩm mới vào giỏ hàng<br> • Nếu đã có: Tăng số lượng sản phẩm<br> • Kiểm tra tồn kho<br> • Cập nhật số lượng trong icon giỏ hàng<br> • Hiển thị thông báo "Đã thêm vào giỏ hàng" |

---

### 2.3.3. Chức năng: Quản lý thông tin cá nhân

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                      |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Quản lý thông tin cá nhân                                                                                                                                                                                                                                                                                  |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                 |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                  |
| **Kích hoạt**          | Người dùng truy cập trang hồ sơ cá nhân                                                                                                                                                                                                                                                                    |
| **Hành động tác nhân** | - Xem thông tin cá nhân (tên, email, SĐT, địa chỉ, ảnh đại diện)<br>- Chỉnh sửa thông tin cá nhân<br>- Quản lý thông tin ngân hàng (thêm/sửa/xóa)<br>- Xem hạng thành viên<br>- Xem lịch sử hoạt động                                                                                                      |
| **Phản ứng hệ thống**  | - Hiển thị thông tin cá nhân hiện tại<br>- Cho phép chỉnh sửa các trường thông tin<br>- Validate dữ liệu khi cập nhật<br>- Lưu thay đổi vào database<br>- Gửi email xác thực khi thay đổi email<br>- Gửi OTP khi thay đổi số điện thoại<br>- Upload và lưu ảnh đại diện<br>- Hiển thị thông báo thành công |

---

### 2.3.4. Chức năng: Quản lý người dùng (Admin)

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                      |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **UseCase**            | Quản lý người dùng                                                                                                                                                                                                                                                                                                                         |
| **Actor**              | Admin                                                                                                                                                                                                                                                                                                                                      |
| **Điều kiện**          | - Admin đã đăng nhập với quyền admin                                                                                                                                                                                                                                                                                                       |
| **Kích hoạt**          | Admin truy cập trang quản lý người dùng                                                                                                                                                                                                                                                                                                    |
| **Hành động tác nhân** | - Xem danh sách người dùng (lọc theo hạng, trạng thái, ngày đăng ký)<br>- Tìm kiếm người dùng<br>- Xem chi tiết người dùng (thông tin, lịch sử mua hàng, rút tiền, số tiền hoàn tiền)<br>- Chỉnh sửa thông tin người dùng<br>- Phân quyền người dùng (Khách hàng/Nhân viên/Admin)<br>- Khóa/Mở khóa tài khoản<br>- Xem thống kê người dùng |
| **Phản ứng hệ thống**  | - Hiển thị danh sách người dùng với các bộ lọc<br>- Cho phép tìm kiếm và lọc theo nhiều tiêu chí<br>- Hiển thị chi tiết đầy đủ về người dùng<br>- Cập nhật thông tin, phân quyền, trạng thái tài khoản<br>- Lưu thay đổi vào database<br>- Gửi thông báo cho người dùng khi có thay đổi                                                    |

---

### 2.3.5. Chức năng: Quản lý sản phẩm (Admin)

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                              |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **UseCase**            | Quản lý sản phẩm                                                                                                                                                                                                                                                                                                   |
| **Actor**              | Admin                                                                                                                                                                                                                                                                                                              |
| **Điều kiện**          | - Admin đã đăng nhập với quyền admin                                                                                                                                                                                                                                                                               |
| **Kích hoạt**          | Admin truy cập trang quản lý sản phẩm                                                                                                                                                                                                                                                                              |
| **Hành động tác nhân** | - Xem danh sách sản phẩm<br>- Thêm sản phẩm mới (nhập thông tin, upload hình ảnh, thiết lập tỷ lệ hoàn tiền, link affiliate)<br>- Sửa sản phẩm (cập nhật giá, mô tả, hình ảnh, tỷ lệ hoàn tiền)<br>- Xóa sản phẩm<br>- Quản lý cửa hàng (thêm/sửa/xóa)<br>- Đồng bộ sản phẩm từ API (AccessTrade, MediaMart, Tiki) |
| **Phản ứng hệ thống**  | - Hiển thị danh sách sản phẩm<br>- Validate dữ liệu khi thêm/sửa<br>- Lưu thông tin sản phẩm vào database<br>- Upload và lưu hình ảnh<br>- Tích hợp với API affiliate để tạo link<br>- Đồng bộ sản phẩm từ các nguồn bên ngoài<br>- Cập nhật thông tin sản phẩm trên frontend                                      |

---

### 2.3.6. Chức năng: Tìm kiếm sản phẩm và cửa hàng

| Thuộc tính             | Mô tả                                                                                                                                                                                                                        |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Tìm kiếm sản phẩm và cửa hàng                                                                                                                                                                                                |
| **Actor**              | Khách hàng, Người dùng                                                                                                                                                                                                       |
| **Điều kiện**          | - Người dùng đã truy cập trang web                                                                                                                                                                                           |
| **Kích hoạt**          | Người dùng nhập từ khóa hoặc chọn bộ lọc                                                                                                                                                                                     |
| **Hành động tác nhân** | - Tìm kiếm theo từ khóa, cửa hàng, danh mục, thương hiệu<br>- Lọc sản phẩm (theo giá, tỷ lệ hoàn tiền, cửa hàng, đánh giá, tình trạng)<br>- Sắp xếp kết quả (giá tăng/giảm, độ bán chạy, mới nhất, tỷ lệ hoàn tiền cao nhất) |
| **Phản ứng hệ thống**  | - Tìm kiếm sản phẩm/cửa hàng trong database<br>- Áp dụng các bộ lọc và sắp xếp<br>- Hiển thị danh sách kết quả phù hợp<br>- Hỗ trợ tìm kiếm tiếng Việt có dấu và không dấu<br>- Phân trang kết quả                           |

---

### 2.3.7. Chức năng: Nhắn tin / Chat hỗ trợ

| Thuộc tính             | Mô tả                                                                                                                                                                                                                   |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Nhắn tin / Chat hỗ trợ                                                                                                                                                                                                  |
| **Actor**              | Người dùng, Admin                                                                                                                                                                                                       |
| **Điều kiện**          | - Người dùng/Admin đã đăng nhập                                                                                                                                                                                         |
| **Kích hoạt**          | Người dùng mở trang chat hỗ trợ hoặc Admin xem tin nhắn chờ                                                                                                                                                             |
| **Hành động tác nhân** | - Người dùng: Soạn và gửi tin nhắn<br>- Admin: Xem tin nhắn, trả lời tin nhắn                                                                                                                                           |
| **Phản ứng hệ thống**  | - Tải danh sách hội thoại và tin nhắn cũ (nếu có)<br>- Lưu tin nhắn vào database<br>- Gửi thông báo real-time qua WebSocket<br>- Hiển thị tin nhắn cho cả người dùng và admin<br>- Đồng bộ tin nhắn theo thời gian thực |

---

### 2.3.8. Chức năng: Chuyển đổi link sản phẩm sang link affiliate

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Chuyển đổi link sản phẩm sang link affiliate                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Điều kiện**          | - Người dùng đã đăng nhập<br>- Người dùng có link sản phẩm muốn mua                                                                                                                                                                                                                                                                                                                                                                                     |
| **Kích hoạt**          | Người dùng nhập link sản phẩm vào hệ thống                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Hành động tác nhân** | Nhập link sản phẩm và yêu cầu chuyển đổi                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Phản ứng hệ thống**  | - Phân tích URL sản phẩm (xác định nguồn: Tiki, Shopee, Lazada, etc.)<br>- Kiểm tra sản phẩm đã có trong database chưa<br>- Nếu có: Lấy link affiliate có sẵn (nếu còn hợp lệ)<br>- Nếu chưa có: Gọi API Affiliate (AccessTrade/MediaMart) để tạo link mới<br>- Lưu thông tin sản phẩm và mapping link vào database<br>- Gắn tracking code (userId) vào link<br>- Hiển thị link affiliate mới cho người dùng<br>- Ghi log khi người dùng click vào link |

---

### 2.3.9. Chức năng: Duyệt yêu cầu rút tiền (Admin)

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Duyệt yêu cầu rút tiền                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Actor**              | Admin                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Điều kiện**          | - Admin đã đăng nhập với quyền admin<br>- Có yêu cầu rút tiền chờ duyệt                                                                                                                                                                                                                                                                                                                                                            |
| **Kích hoạt**          | Admin truy cập trang quản lý rút tiền                                                                                                                                                                                                                                                                                                                                                                                              |
| **Hành động tác nhân** | - Xem danh sách yêu cầu rút tiền chờ duyệt<br>- Xem chi tiết yêu cầu (người dùng, số tiền, thông tin ngân hàng)<br>- Click "Duyệt" hoặc "Từ chối" yêu cầu                                                                                                                                                                                                                                                                          |
| **Phản ứng hệ thống**  | - Hiển thị danh sách yêu cầu với thông tin chi tiết<br>- Kiểm tra số dư người dùng<br>- Nếu duyệt:<br> • Cập nhật trạng thái yêu cầu = "approved"<br> • Trừ số tiền từ tài khoản người dùng<br> • Gửi yêu cầu chuyển khoản đến hệ thống thanh toán<br> • Lưu lịch sử giao dịch<br> • Gửi email thông báo cho người dùng<br>- Nếu từ chối:<br> • Cập nhật trạng thái = "rejected"<br> • Lưu lý do từ chối<br> • Gửi email thông báo |

---

### 2.3.10. Chức năng: Gửi yêu cầu hoàn tiền

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **UseCase**            | Gửi yêu cầu hoàn tiền                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Điều kiện**          | - Người dùng đã đăng nhập<br>- Người dùng có đơn hàng chưa được duyệt                                                                                                                                                                                                                                                                                                                                                                      |
| **Kích hoạt**          | Người dùng xem lịch sử mua hàng và chọn đơn hàng                                                                                                                                                                                                                                                                                                                                                                                           |
| **Hành động tác nhân** | - Xem lịch sử mua hàng<br>- Chọn đơn hàng chưa được duyệt<br>- Click "Gửi yêu cầu hoàn tiền"                                                                                                                                                                                                                                                                                                                                               |
| **Phản ứng hệ thống**  | - Hiển thị danh sách đơn hàng<br>- Kiểm tra trạng thái đơn hàng<br>- Nếu đơn hàng đã được duyệt: Thông báo "Đơn hàng đã được duyệt, cashback đã được tính"<br>- Nếu đơn hàng chưa được duyệt:<br> • Kiểm tra đã có yêu cầu chưa<br> • Nếu chưa có: Tạo yêu cầu hoàn tiền mới (status=pending)<br> • Cập nhật trạng thái đơn hàng<br> • Thông báo "Yêu cầu hoàn tiền đã được gửi"<br>- Tự động xử lý khi nhận webhook từ Affiliate (nếu có) |

---

### 2.3.11. Chức năng: Quên mật khẩu

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Quên mật khẩu / Đặt lại mật khẩu                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Điều kiện**          | - Người dùng đã truy cập trang web                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Kích hoạt**          | Người dùng click "Quên mật khẩu" trên trang đăng nhập                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Hành động tác nhân** | - Nhập email và click "Gửi"<br>- Click link reset password trong email<br>- Nhập mật khẩu mới và xác nhận                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Phản ứng hệ thống**  | - Kiểm tra email có tồn tại trong hệ thống<br>- Nếu email tồn tại:<br> • Tạo reset token (32 ký tự, hết hạn sau 1 giờ)<br> • Lưu token vào database<br> • Gửi email chứa link reset password<br> • Thông báo "Vui lòng kiểm tra email"<br>- Khi người dùng click link:<br> • Xác thực token (kiểm tra hợp lệ và chưa hết hạn)<br> • Hiển thị form đặt lại mật khẩu<br> • Validate mật khẩu mới (độ dài, độ mạnh)<br> • Hash mật khẩu mới và cập nhật<br> • Xóa token đã sử dụng<br> • Gửi email xác nhận<br> • Redirect đến trang đăng nhập |

---

### 2.3.12. Chức năng: Xem và chỉnh sửa hồ sơ

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                        |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Xem và chỉnh sửa hồ sơ cá nhân                                                                                                                                                                                                                                                                                               |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                   |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                    |
| **Kích hoạt**          | Người dùng truy cập trang hồ sơ cá nhân                                                                                                                                                                                                                                                                                      |
| **Hành động tác nhân** | - Xem thông tin hồ sơ (thông tin cơ bản, ảnh, địa chỉ, ngân hàng, hạng thành viên, số tiền hoàn tiền)<br>- Cập nhật thông tin cơ bản (tên, địa chỉ)<br>- Cập nhật email (cần xác thực qua email)<br>- Cập nhật số điện thoại (cần xác thực qua OTP)<br>- Upload ảnh đại diện<br>- Quản lý thông tin ngân hàng (thêm/sửa/xóa) |
| **Phản ứng hệ thống**  | - Hiển thị thông tin hồ sơ hiện tại<br>- Validate dữ liệu khi cập nhật<br>- Lưu thay đổi vào database<br>- Gửi email xác thực khi thay đổi email<br>- Gửi OTP khi thay đổi số điện thoại<br>- Upload, resize và lưu ảnh đại diện<br>- Hiển thị thông báo thành công                                                          |

---

### 2.3.13. Chức năng: Hệ thống hạng thành viên

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                         |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Hệ thống hạng thành viên                                                                                                                                                                                                                                                                                                      |
| **Actor**              | Người dùng, Hệ thống                                                                                                                                                                                                                                                                                                          |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                     |
| **Kích hoạt**          | Người dùng truy cập trang hạng thành viên hoặc đơn hàng được duyệt                                                                                                                                                                                                                                                            |
| **Hành động tác nhân** | - Xem thông tin hạng thành viên hiện tại<br>- Xem hạng tiếp theo và số tiền cần để lên hạng<br>- Xem lợi ích của từng hạng                                                                                                                                                                                                    |
| **Phản ứng hệ thống**  | - Tính tổng tiền đã chi tiêu từ đơn hàng đã duyệt<br>- Xác định hạng hiện tại (None/Bronze/Silver/Gold)<br>- Tính hạng tiếp theo và số tiền cần<br>- Tự động nâng hạng khi đạt ngưỡng<br>- Tạo voucher chúc mừng khi nâng hạng<br>- Áp dụng bonus cashback theo hạng khi tính cashback<br>- Gửi email chúc mừng khi nâng hạng |

---

### 2.3.14. Chức năng: Điểm danh hàng ngày

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Điểm danh hàng ngày                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Kích hoạt**          | Người dùng truy cập trang điểm danh                                                                                                                                                                                                                                                                                                                                                                                               |
| **Hành động tác nhân** | - Xem lịch điểm danh tuần (7 ngày)<br>- Click "Điểm danh hôm nay"<br>- Xem lịch sử điểm danh                                                                                                                                                                                                                                                                                                                                      |
| **Phản ứng hệ thống**  | - Hiển thị lịch điểm danh tuần với phần trăm voucher từng ngày (Thứ 2=1%, Thứ 3=2%, ..., Chủ nhật=7%)<br>- Kiểm tra đã điểm danh hôm nay chưa<br>- Nếu chưa điểm danh:<br> • Tạo voucher cashback theo phần trăm của ngày<br> • Cập nhật check-in record (thêm ngày vào danh sách, cập nhật streak)<br> • Thông báo "Điểm danh thành công! Nhận voucher X%"<br>- Mỗi ngày chỉ được điểm danh 1 lần<br>- Tuần mới reset lại từ đầu |

---

### 2.3.15. Chức năng: Vòng quay may mắn

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ---------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Vòng quay may mắn                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Actor**              | Người dùng, Hệ thống                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Kích hoạt**          | Người dùng truy cập trang vòng quay hoặc đơn hàng được duyệt                                                                                                                                                                                                                                                                                                                                                                                   |
| **Hành động tác nhân** | - Xem số lượt quay hiện có<br>- Click "Quay" để quay vòng quay<br>- Xem lịch sử quay                                                                                                                                                                                                                                                                                                                                                           |
| **Phản ứng hệ thống**  | - Kiểm tra đơn hàng mới chưa nhận lượt quay, tự động cộng lượt<br>- Hiển thị số lượt quay và danh sách phần thưởng<br>- Khi quay:<br> • Kiểm tra còn lượt quay không<br> • Random chọn phần thưởng theo tỷ lệ (voucher/tiền/điểm/không trúng)<br> • Trừ 1 lượt quay<br> • Lưu kết quả vào lịch sử<br> • Cộng phần thưởng vào tài khoản (nếu trúng)<br> • Hiển thị kết quả<br>- Tự động nhận lượt quay khi đơn hàng được duyệt (1 đơn = 1 lượt) |

---

### 2.3.16. Chức năng: Trò chơi vườn cây

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Trò chơi vườn cây                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Actor**              | Người dùng                                                                                                                                                                                                                                                                                                                                                                                                                |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Kích hoạt**          | Người dùng truy cập trang vườn cây                                                                                                                                                                                                                                                                                                                                                                                        |
| **Hành động tác nhân** | - Xem trạng thái vườn cây (loại cây, level, health, water)<br>- Trồng cây (nếu chưa có)<br>- Tưới cây (có cooldown)<br>- Thu hoạch cây (khi đủ điều kiện)<br>- Xem lịch sử thu hoạch                                                                                                                                                                                                                                      |
| **Phản ứng hệ thống**  | - Hiển thị trạng thái cây hiện tại<br>- Khi trồng: Tạo cây mới (level=1, health=100, water=0)<br>- Khi tưới:<br> • Kiểm tra cooldown<br> • Tăng water (+10) và health (+5)<br> • Tự động lên level nếu đủ điều kiện<br>- Khi thu hoạch:<br> • Kiểm tra điều kiện (level, health, thời gian)<br> • Tính phần thưởng theo level<br> • Cộng phần thưởng vào tài khoản<br> • Reset cây về level 1<br> • Lưu lịch sử thu hoạch |

---

### 2.3.17. Chức năng: Hệ thống giới thiệu bạn bè

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Hệ thống giới thiệu bạn bè                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **Actor**              | Người dùng, Người được giới thiệu                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Điều kiện**          | - Người dùng đã đăng nhập (để xem mã giới thiệu)<br>- Người được giới thiệu chưa có tài khoản                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Kích hoạt**          | Người dùng xem mã giới thiệu hoặc người được giới thiệu đăng ký bằng mã                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Hành động tác nhân** | - Người dùng: Xem mã giới thiệu và chia sẻ<br>- Người được giới thiệu: Đăng ký tài khoản với mã giới thiệu<br>- Người dùng: Xem danh sách người được giới thiệu và lịch sử thưởng                                                                                                                                                                                                                                                                                                                                       |
| **Phản ứng hệ thống**  | - Tạo mã giới thiệu unique (8 ký tự) nếu chưa có<br>- Khi đăng ký bằng mã:<br> • Tìm người giới thiệu theo mã<br> • Tạo tài khoản mới với referredBy<br> • Tạo referral_reward record (status=pending)<br> • Gửi email chúc mừng cho cả 2 người<br>- Tự động tra thưởng khi người được giới thiệu mua hàng và đơn được duyệt:<br> • Tính thưởng theo cấu hình<br> • Cập nhật referral_reward (status=approved)<br> • Cộng tiền thưởng vào tài khoản người giới thiệu<br> • Lưu lịch sử thưởng<br> • Gửi email thông báo |

---

### 2.3.18. Chức năng: Bảng xếp hạng

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                  |
| ---------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Bảng xếp hạng                                                                                                                                                                                                                                                                                                                          |
| **Actor**              | Người dùng, Admin, Hệ thống                                                                                                                                                                                                                                                                                                            |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                              |
| **Kích hoạt**          | Người dùng truy cập trang bảng xếp hạng hoặc cuối tháng (tự động tra thưởng)                                                                                                                                                                                                                                                           |
| **Hành động tác nhân** | - Xem bảng xếp hạng (top 10)<br>- Xem thứ hạng của mình<br>- Admin: Cấu hình thưởng top 3                                                                                                                                                                                                                                              |
| **Phản ứng hệ thống**  | - Tính bảng xếp hạng theo tiêu chí (tổng chi tiêu, tổng cashback, số đơn hàng)<br>- Sắp xếp và hiển thị top 10<br>- Tìm và hiển thị vị trí của user hiện tại<br>- Cuối mỗi kỳ (tháng):<br> • Xác định top 3<br> • Tự động tra thưởng cho top 3<br> • Cộng tiền thưởng vào tài khoản<br> • Lưu lịch sử thưởng<br> • Gửi email chúc mừng |

---

### 2.3.19. Chức năng: Voucher cashback

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Voucher cashback                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| **Actor**              | Người dùng, Admin, Hệ thống                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Điều kiện**          | - Người dùng đã đăng nhập                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Kích hoạt**          | Người dùng xem voucher, áp dụng voucher khi mua hàng, hoặc nhận voucher từ các nguồn                                                                                                                                                                                                                                                                                                                                                                                                      |
| **Hành động tác nhân** | - Xem danh sách voucher (available/used/expired)<br>- Áp dụng voucher vào đơn hàng<br>- Admin: Tạo voucher cho user hoặc hàng loạt                                                                                                                                                                                                                                                                                                                                                        |
| **Phản ứng hệ thống**  | - Hiển thị danh sách voucher với trạng thái<br>- Kiểm tra voucher hết hạn và cập nhật status<br>- Khi áp dụng voucher:<br> • Kiểm tra voucher hợp lệ (status, expiredAt, minOrderAmount)<br> • Tính cashback với voucher (baseCashback \* (1 + voucherPercentage))<br> • Cập nhật đơn hàng với voucherCode<br> • Đánh dấu voucher đã sử dụng<br>- Tự động tạo voucher từ các nguồn:<br> • Điểm danh hàng ngày<br> • Nâng hạng thành viên<br> • Vòng quay may mắn<br> • Admin tạo thủ công |

---

### 2.3.20. Chức năng: Thống kê và báo cáo (Admin)

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                 |
| ---------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **UseCase**            | Thống kê và báo cáo                                                                                                                                                                                                                                                                                                                                   |
| **Actor**              | Admin                                                                                                                                                                                                                                                                                                                                                 |
| **Điều kiện**          | - Admin đã đăng nhập với quyền admin                                                                                                                                                                                                                                                                                                                  |
| **Kích hoạt**          | Admin truy cập trang dashboard hoặc thống kê                                                                                                                                                                                                                                                                                                          |
| **Hành động tác nhân** | - Xem dashboard tổng quan<br>- Xem thống kê doanh thu (theo thời gian, cửa hàng, danh mục)<br>- Xem thống kê người dùng (hạng thành viên, xu hướng đăng ký, hoạt động)<br>- Xem thống kê đơn hàng (theo trạng thái, giá trị, xu hướng)<br>- Xem thống kê cashback (tổng, theo hạng, theo voucher)<br>- Xuất báo cáo (PDF/Excel)                       |
| **Phản ứng hệ thống**  | - Tính toán và hiển thị các chỉ số tổng quan (số user, doanh thu, đơn hàng, cashback)<br>- Tạo biểu đồ thống kê (line chart, bar chart, pie chart)<br>- Cho phép lọc theo thời gian (ngày, tuần, tháng, năm)<br>- So sánh giữa các kỳ<br>- Tạo file báo cáo PDF hoặc Excel<br> • Thu thập tất cả dữ liệu thống kê<br> • Tạo file và cho phép download |

---

### 2.3.21. Chức năng: Duyệt đơn hàng (Admin)

| Thuộc tính             | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **UseCase**            | Duyệt đơn hàng                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Actor**              | Admin                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Điều kiện**          | - Admin đã đăng nhập với quyền admin<br>- Có đơn hàng chờ duyệt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Kích hoạt**          | Admin truy cập trang quản lý đơn hàng                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **Hành động tác nhân** | - Xem danh sách đơn hàng (lọc theo trạng thái, ngày, cửa hàng, user)<br>- Xem chi tiết đơn hàng<br>- Click "Duyệt" hoặc "Hủy" đơn hàng                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **Phản ứng hệ thống**  | - Hiển thị danh sách đơn hàng với thông tin chi tiết<br>- Khi duyệt đơn hàng:<br> • Tính cashback (base + bonus từ hạng + voucher)<br> • Cập nhật trạng thái đơn hàng = "approved"<br> • Cộng cashback vào balance người dùng<br> • Cộng vào totalSpent<br> • Đánh dấu voucher đã sử dụng (nếu có)<br> • Kiểm tra và nâng hạng thành viên nếu đủ điều kiện<br> • Tạo lượt quay vòng quay may mắn<br> • Gửi email thông báo cho người dùng<br>- Khi hủy đơn hàng:<br> • Cập nhật trạng thái = "cancelled"<br> • Lưu lý do hủy<br> • Gửi email thông báo |

---

## Tổng kết

Tài liệu này mô tả đầy đủ 21 use case chính của hệ thống SmartCash Shopping, bao gồm:

- 12 use case cơ bản (đăng nhập, quản lý thông tin, giỏ hàng, v.v.)
- 9 use case tính năng nâng cao (hạng thành viên, điểm danh, vòng quay, trò chơi, giới thiệu, bảng xếp hạng, voucher, thống kê, duyệt đơn hàng)

Mỗi use case được mô tả chi tiết với các thuộc tính: UseCase, Actor, Điều kiện, Kích hoạt, Hành động tác nhân, và Phản ứng hệ thống.
